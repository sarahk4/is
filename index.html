<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Pencatatan Keuangan Harian</title>
  <style>
    body { font-family: sans-serif; background: #f0f0f0; padding: 20px; }
    h2 { margin-top: 40px; }
    table { border-collapse: collapse; width: 100%; margin-top: 10px; background: #fff; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    input, select, button { padding: 10px; margin: 5px; }
    #loginContainer { text-align: center; margin-top: 100px; }
    #appContainer { display: none; }
    .laporan { margin: 10px 0; padding: 10px; background: #e0e0e0; }
  </style>
</head>
<body>

<!-- LOGIN -->
<div id="loginContainer">
  <h2>ğŸ” Masukkan Password</h2>
  <input type="password" id="passwordInput" placeholder="Password">
  <br>
  <button onclick="checkPassword()">ğŸ”“ Masuk</button>
  <p id="errorMessage" style="color: red;"></p>
</div>

<!-- APP -->
<div id="appContainer">
  <h2>ğŸ“‹ Input Pencatatan Keuangan</h2>
  <form id="formInput">
    <input type="text" id="deskripsi" placeholder="Deskripsi" required>
    <select id="jenis" required>
      <option value="">Pilih Jenis</option>
      <option value="Pendapatan">Pendapatan</option>
      <option value="Pengeluaran">Pengeluaran</option>
    </select>
    <select id="nominalSelect" onchange="toggleManualInput()" required>
      <option value="">Pilih Nominal</option>
      <option>100</option>
      <option>1000</option>
      <option>5000</option>
      <option>20000</option>
      <option>50000</option>
      <option>100000</option>
      <option value="lainnya">Lainnya</option>
    </select>
    <input type="number" id="manualNominal" placeholder="Nominal Manual" style="display:none;" min="0">
    <button type="submit">â• Tambah</button>
  </form>

  <div id="semuaData"></div>
</div>

<script>
  const correctPassword = "mm2";
  const dataPerTanggal = {}; // { '2025-07-20': [data, data, ...] }

  function checkPassword() {
    const input = document.getElementById("passwordInput").value;
    if (input === correctPassword) {
      document.getElementById("loginContainer").style.display = "none";
      document.getElementById("appContainer").style.display = "block";
    } else {
      document.getElementById("errorMessage").textContent = "âŒ Password salah!";
    }
  }

  function toggleManualInput() {
    const select = document.getElementById("nominalSelect");
    const manual = document.getElementById("manualNominal");
    manual.style.display = select.value === "lainnya" ? "inline-block" : "none";
    if (select.value !== "lainnya") manual.value = "";
  }

  document.getElementById("formInput").addEventListener("submit", function(e) {
    e.preventDefault();

    const deskripsi = document.getElementById("deskripsi").value;
    const jenis = document.getElementById("jenis").value;
    const selectNominal = document.getElementById("nominalSelect");
    const manualNominal = document.getElementById("manualNominal");

    let nominal = selectNominal.value === "lainnya" ? manualNominal.value : selectNominal.value;
    nominal = Number(nominal);

    const now = new Date();
    const tanggal = now.toLocaleDateString('sv-SE', { timeZone: 'Asia/Jakarta' }); // YYYY-MM-DD
    const waktu = now.toLocaleTimeString('id-ID', { hour12: false, timeZone: 'Asia/Jakarta' });
    const hari = now.toLocaleDateString('id-ID', { weekday: 'long', timeZone: 'Asia/Jakarta' });

    const entry = { tanggal, waktu, hari, deskripsi, jenis, nominal };

    if (!dataPerTanggal[tanggal]) dataPerTanggal[tanggal] = [];
    dataPerTanggal[tanggal].push(entry);

    renderAllTables();
    document.getElementById("formInput").reset();
    toggleManualInput();
  });

  function renderAllTables() {
    const container = document.getElementById("semuaData");
    container.innerHTML = "";

    const tanggalList = Object.keys(dataPerTanggal).sort().reverse(); // Tampilkan terbaru dulu

    tanggalList.forEach(tanggal => {
      const data = dataPerTanggal[tanggal];
      let totalPendapatan = 0;
      let totalPengeluaran = 0;

      const tabel = document.createElement("table");
      const thead = document.createElement("thead");
      thead.innerHTML = `
        <tr>
          <th colspan="6">ğŸ“… Tanggal: ${tanggal}</th>
        </tr>
        <tr>
          <th>Waktu</th>
          <th>Hari</th>
          <th>Deskripsi</th>
          <th>Jenis</th>
          <th>Nominal</th>
        </tr>`;
      tabel.appendChild(thead);

      const tbody = document.createElement("tbody");

      data.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${item.waktu}</td>
          <td>${item.hari}</td>
          <td>${item.deskripsi}</td>
          <td>${item.jenis}</td>
          <td>${item.nominal.toLocaleString("id-ID")}</td>`;
        tbody.appendChild(tr);

        if (item.jenis === "Pendapatan") totalPendapatan += item.nominal;
        if (item.jenis === "Pengeluaran") totalPengeluaran += item.nominal;
      });

      const laporan = document.createElement("div");
      laporan.className = "laporan";
      laporan.innerHTML = `
        <strong>ğŸ“¥ Pendapatan:</strong> ${totalPendapatan.toLocaleString("id-ID")}<br>
        <strong>ğŸ“¤ Pengeluaran:</strong> ${totalPengeluaran.toLocaleString("id-ID")}<br>
        <strong>ğŸ’° Saldo:</strong> ${(totalPendapatan - totalPengeluaran).toLocaleString("id-ID")}`;

      tabel.appendChild(tbody);
      container.appendChild(laporan);
      container.appendChild(tabel);
    });
  }
</script>

</body>
</html>
